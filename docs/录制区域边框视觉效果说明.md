# 录制区域边框视觉效果说明

## 功能概述

实现了录制区域的视觉反馈效果，通过不同状态的边框样式和动画，让用户清楚地了解当前的录制状态。

## 功能特性

### 1. 选中区域后 - 实线框

**状态**: 已确认选择，等待开始录制

**视觉效果**:
- 实线边框（3px）
- 颜色：紫色 `#667eea`（主题色）
- 半透明黑色遮罩覆盖其他区域
- 四角显示圆形指示器

**交互**:
- 信息面板隐藏
- 鼠标交互禁用
- 边框保持静止

### 2. 开始录制后 - 闪烁渐变紫色光

**状态**: 正在录制

**视觉效果**:
- 边框加粗（4px）
- 颜色：紫色渐变动画
  - 起始：`#667eea` (紫蓝色)
  - 中间：`#764ba2` (紫色)
  - 结束：`#f093fb` (粉紫色)
- 发光效果：
  - 内发光：20-30px
  - 外发光：20-60px
  - 阴影模糊：多层叠加
- 动画周期：2秒无限循环

**角标动画**:
- 四角圆形指示器同步闪烁
- 颜色随边框渐变
- 发光效果增强

### 3. 点击暂停 - 停止闪烁

**状态**: 录制暂停

**视觉效果**:
- 实线边框（3px）
- 颜色：橙色 `#f59e0b`（警告色）
- 停止所有动画
- 保持静态显示

**交互**:
- 边框保持可见
- 等待恢复或停止

### 4. 点击结束 - 边框消失

**状态**: 录制完成

**视觉效果**:
- 选择器窗口关闭
- 边框完全消失
- 恢复正常桌面

## 技术实现

### 1. CSS 样式

#### 已确认状态
```css
.selection-box.confirmed {
  display: block;
  border: 3px solid #667eea;
  background-color: transparent;
  box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5);
}
```

#### 录制状态（闪烁渐变）
```css
.selection-box.recording {
  display: block;
  border: 4px solid #667eea;
  box-shadow:
    0 0 0 9999px rgba(0, 0, 0, 0.5),
    0 0 20px rgba(102, 126, 234, 0.8),
    0 0 40px rgba(118, 75, 162, 0.6),
    inset 0 0 20px rgba(102, 126, 234, 0.3);
  animation: recordingGlow 2s ease-in-out infinite;
}

@keyframes recordingGlow {
  0%, 100% {
    border-color: #667eea;
    box-shadow: /* 紫蓝色发光 */;
  }
  50% {
    border-color: #764ba2;
    box-shadow: /* 粉紫色发光 */;
  }
}
```

#### 暂停状态
```css
.selection-box.paused {
  display: block;
  border: 3px solid #f59e0b;
  background-color: transparent;
  box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5);
}
```

### 2. JavaScript 状态管理

#### 状态变量
```javascript
let isConfirmed = false;
let recordingState = 'idle'; // idle, recording, paused
```

#### 确认选择
```javascript
async function confirmSelection(bounds) {
  isConfirmed = true;
  selectionBox.classList.remove('active');
  selectionBox.classList.add('confirmed');
  infoPanel.classList.add('hidden');
  overlay.style.pointerEvents = 'none';
  await window.electronAPI.areaSelected(bounds);
}
```

#### 监听录制状态
```javascript
window.electronAPI.onRecordingStatus((status) => {
  if (!isConfirmed) return;

  if (status.status === 'recording') {
    selectionBox.classList.remove('confirmed', 'paused');
    selectionBox.classList.add('recording');
  } else if (status.status === 'paused') {
    selectionBox.classList.remove('recording');
    selectionBox.classList.add('paused');
  } else if (status.status === 'completed' || status.status === 'error') {
    window.electronAPI.closeSelector();
  }
});
```

### 3. 主进程逻辑

#### 保持选择器窗口
```javascript
ipcMain.handle('area-selected', (event, bounds) => {
  if (mainWindow) {
    mainWindow.webContents.send('area-selected', bounds);
  }
  // 不关闭选择器窗口，保持显示边框
  return { success: true };
});
```

#### 录制状态广播
```javascript
recorder.onStatusChange = (status) => {
  if (mainWindow) {
    mainWindow.webContents.send('recording-status', status);
  }
  // 同时向选择器窗口发送状态
  if (selectorWindow) {
    selectorWindow.webContents.send('recording-status', status);
  }
};
```

#### 停止时关闭选择器
```javascript
ipcMain.handle('stop-recording', async () => {
  const result = recorder.stopRecording();
  if (selectorWindow) {
    selectorWindow.close();
  }
  return result;
});
```

## 动画细节

### 渐变色序列
1. **起始** (0%): `#667eea` - 紫蓝色
2. **中间** (50%): `#764ba2` - 深紫色
3. **结束** (100%): `#667eea` - 回到紫蓝色

### 发光效果
- **外发光**: 20-60px 模糊半径
- **内发光**: 20-30px 模糊半径
- **颜色透明度**: 0.3-1.0 渐变
- **多层叠加**: 3-4 层阴影

### 角标动画
- **大小**: 10x10 像素圆形
- **位置**: 四角外侧 6px
- **颜色**: 随边框同步渐变
- **发光**: 10-15px 模糊半径

## 状态流转

```
选择区域 → 确认选择 → 开始录制 → 暂停 → 恢复 → 停止
   ↓          ↓          ↓        ↓      ↓      ↓
 active → confirmed → recording → paused → recording → 关闭
```

## 用户体验

### 视觉反馈
- ✅ 清晰的状态指示
- ✅ 吸引注意力的动画
- ✅ 符合主题色的设计
- ✅ 不干扰录制内容

### 交互反馈
- ✅ 确认后禁用鼠标交互
- ✅ 隐藏信息面板减少干扰
- ✅ 暂停时停止动画节省资源
- ✅ 结束时自动清理

## 性能优化

### CSS 动画
- 使用 GPU 加速（transform, opacity）
- 避免触发重排（layout）
- 合理的动画周期（2秒）

### 状态管理
- 只在确认后监听状态
- 及时清理事件监听
- 避免不必要的 DOM 操作

## 文件变更

### 修改的文件
1. **src/selector/selector.css** - 添加状态样式和动画
   - `.selection-box.confirmed` - 确认状态
   - `.selection-box.recording` - 录制状态
   - `.selection-box.paused` - 暂停状态
   - `@keyframes recordingGlow` - 录制动画
   - `@keyframes cornerGlow` - 角标动画

2. **src/selector/selector.js** - 状态管理和监听
   - 添加 `isConfirmed` 和 `recordingState` 状态
   - 修改 `confirmSelection()` 不关闭窗口
   - 添加 `onRecordingStatus` 监听器

3. **main.js** - 窗口生命周期管理
   - 修改 `area-selected` 不关闭选择器
   - 修改 `start-recording` 不关闭选择器
   - 修改 `stop-recording` 关闭选择器
   - 修改 `recorder.onStatusChange` 广播到选择器

### 新增的文件
- **docs/录制区域边框视觉效果说明.md** - 本文档

## 测试建议

### 功能测试
1. ✅ 选择区域后显示实线框
2. ✅ 开始录制后边框开始闪烁
3. ✅ 暂停录制后停止闪烁
4. ✅ 恢复录制后继续闪烁
5. ✅ 停止录制后边框消失

### 视觉测试
1. ✅ 渐变色过渡流畅
2. ✅ 发光效果明显
3. ✅ 角标动画同步
4. ✅ 颜色符合主题

### 性能测试
1. ✅ 动画流畅不卡顿
2. ✅ CPU 占用合理
3. ✅ 不影响录制质量

## 已知问题

### 多显示器
- 选择器窗口在主显示器上
- 跨显示器录制可能看不到边框

### 高 DPI
- 边框粗细可能需要调整
- 发光效果可能过于强烈

## 未来改进

1. **自适应边框**: 根据选择区域大小调整边框粗细
2. **自定义颜色**: 允许用户自定义边框颜色
3. **更多动画**: 添加更多录制状态的视觉效果
4. **性能模式**: 低性能设备可关闭动画

---

**实现日期**: 2026-02-06
**版本**: 1.0
**参考**: 主题色渐变设计
