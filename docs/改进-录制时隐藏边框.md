# 改进：录制时隐藏选择器边框

## 问题描述

**问题**: 录制时，选择器窗口的边框会被录制到视频中，影响录制内容的纯净度。

**影响**:
- 录制的视频包含不必要的边框
- 影响视频的专业性
- 用户体验不佳

## 解决方案

### 核心思路

在不同的录制状态下，动态控制选择器窗口的可见性：

1. **录制中**: 隐藏选择器窗口（边框不被录制）
2. **暂停时**: 显示选择器窗口（显示暂停状态的橙色边框）
3. **恢复录制**: 再次隐藏选择器窗口
4. **停止录制**: 关闭选择器窗口

### 实现细节

#### 1. 开始录制时隐藏

```javascript
ipcMain.handle('start-recording', async (event, bounds) => {
  try {
    const settings = loadSettings();
    await recorder.startRecording(bounds, settings);

    // 隐藏选择器窗口，避免边框被录制到视频中
    if (selectorWindow) {
      selectorWindow.hide();
    }

    // 开始录制时自动切换到简化模式
    if (!isCompactMode) {
      toggleCompactMode();
    }

    return { success: true };
  } catch (error) {
    console.error('Error starting recording:', error);
    return { success: false, error: error.message };
  }
});
```

#### 2. 暂停时显示

```javascript
ipcMain.handle('pause-recording', () => {
  // 暂停时显示选择器窗口（显示暂停状态的边框）
  if (selectorWindow) {
    selectorWindow.show();
  }
  return recorder.pauseRecording();
});
```

**原因**:
- 暂停时不录制，可以显示边框
- 让用户看到暂停状态（橙色边框）
- 提供视觉反馈

#### 3. 恢复录制时隐藏

```javascript
ipcMain.handle('resume-recording', () => {
  // 恢复录制时隐藏选择器窗口
  if (selectorWindow) {
    selectorWindow.hide();
  }
  return recorder.resumeRecording();
});
```

#### 4. 停止时关闭

```javascript
ipcMain.handle('stop-recording', async () => {
  try {
    const result = recorder.stopRecording();

    // 停止录制时关闭选择器窗口
    if (selectorWindow) {
      selectorWindow.close();
    }

    // 停止录制时恢复正常模式
    if (isCompactMode) {
      toggleCompactMode();
    }

    return result;
  } catch (error) {
    console.error('Error stopping recording:', error);
    return { success: false, error: error.message };
  }
});
```

## 状态流转

### 选择器窗口可见性

```
选择区域 → 确认选择 → 开始录制 → 暂停 → 恢复 → 停止
   ↓          ↓          ↓        ↓      ↓      ↓
 显示    →  显示    →  隐藏  →  显示 → 隐藏 → 关闭
(边框)    (实线框)   (无边框)  (橙框)  (无边框)
```

### 录制内容

```
开始录制 → 录制中（无边框）→ 暂停（不录制）→ 恢复（无边框）→ 停止
   ↓           ↓                ↓              ↓          ↓
 隐藏边框   纯净内容         显示边框       纯净内容    结束
```

## 用户体验

### 优点

1. **纯净录制**: 视频中不包含边框，内容更专业
2. **视觉反馈**: 暂停时显示边框，用户知道当前状态
3. **灵活控制**: 通过简化模式窗口控制录制

### 暂停时的视觉反馈

**为什么暂停时显示边框？**

1. **状态指示**: 橙色边框明确显示暂停状态
2. **区域提醒**: 用户可以看到录制区域
3. **不影响录制**: 暂停时不录制，边框不会进入视频

### 录制时的控制

**如何控制录制？**

1. **简化模式窗口**: 自动切换到简化模式（120px宽）
2. **控制按钮**: 暂停、恢复、停止按钮
3. **菜单栏**: 通过菜单栏控制

## 技术实现

### Electron 窗口 API

#### hide()
```javascript
selectorWindow.hide();
```
- 隐藏窗口但不销毁
- 窗口仍在内存中
- 可以快速显示

#### show()
```javascript
selectorWindow.show();
```
- 显示之前隐藏的窗口
- 保持窗口状态
- 立即可见

#### close()
```javascript
selectorWindow.close();
```
- 关闭并销毁窗口
- 释放内存
- 需要重新创建

### 性能影响

**hide/show vs close/create**

| 操作 | 性能 | 内存 | 状态保持 |
|------|------|------|----------|
| hide/show | 快 | 占用 | ✅ |
| close/create | 慢 | 释放 | ❌ |

**选择 hide/show 的原因**:
- 快速切换
- 保持边框状态
- 避免重新创建窗口的开销

## 边界情况

### 1. 窗口不存在

```javascript
if (selectorWindow) {
  selectorWindow.hide();
}
```
- 检查窗口是否存在
- 避免空指针错误

### 2. 快速切换

**场景**: 用户快速点击暂停/恢复

**处理**:
- hide/show 操作很快
- 不会出现闪烁
- 状态同步正确

### 3. 多显示器

**问题**: 选择器窗口在主显示器

**影响**:
- 如果录制其他显示器，边框不可见
- 但不影响录制（边框已隐藏）

## 测试验证

### 测试步骤

1. **录制测试**
   - 选择区域
   - 开始录制
   - 验证：边框不可见
   - 验证：视频中无边框

2. **暂停测试**
   - 录制中点击暂停
   - 验证：橙色边框显示
   - 验证：录制已暂停

3. **恢复测试**
   - 暂停后点击恢复
   - 验证：边框消失
   - 验证：继续录制

4. **停止测试**
   - 点击停止
   - 验证：边框消失
   - 验证：视频完整

### 预期结果

- ✅ 录制视频中无边框
- ✅ 暂停时显示橙色边框
- ✅ 恢复后边框消失
- ✅ 停止后窗口关闭

## 文件变更

### 修改的文件

1. **main.js**
   - `start-recording`: 添加 `selectorWindow.hide()`
   - `pause-recording`: 添加 `selectorWindow.show()`
   - `resume-recording`: 添加 `selectorWindow.hide()`
   - `stop-recording`: 保持 `selectorWindow.close()`

### 代码行数

- 修改行数: ~15 行
- 新增行数: ~9 行
- 删除行数: ~3 行

## 相关功能

### 简化模式

**配合使用**:
- 录制时自动切换到简化模式
- 简化模式窗口用于控制录制
- 不影响录制内容

### 边框动画

**保持功能**:
- 确认后显示实线框
- 录制时的闪烁动画（虽然隐藏）
- 暂停时的橙色边框

## 未来改进

### 1. 半透明边框

**想法**: 录制时显示半透明边框
- 优点：用户可以看到录制区域
- 缺点：边框会被录制进去

### 2. 屏幕外指示器

**想法**: 在屏幕边缘显示录制指示器
- 优点：不影响录制内容
- 缺点：可能不够明显

### 3. 系统托盘指示

**想法**: 在系统托盘显示录制状态
- 优点：不占用屏幕空间
- 缺点：用户可能忽略

## 总结

### 改进内容

- ✅ 录制时隐藏选择器窗口
- ✅ 暂停时显示选择器窗口
- ✅ 恢复时再次隐藏
- ✅ 停止时关闭窗口

### 用户价值

- 纯净的录制内容
- 清晰的状态反馈
- 专业的视频输出

### 技术价值

- 简单的实现
- 良好的性能
- 易于维护

---

**实现日期**: 2026-02-06
**版本**: 1.0
**类型**: 功能改进
